package com.ezen.myProject.handler;

import java.io.File;
import java.util.ArrayList;
import java.util.List;

import org.apache.poi.ss.formula.functions.Replace;
import org.joda.time.LocalDate;
import org.springframework.stereotype.Component;
import org.springframework.web.multipart.MultipartFile;

import com.ezen.myProject.domain.fileVO;

import lombok.AllArgsConstructor;
import lombok.extern.slf4j.Slf4j;

@Slf4j
@AllArgsConstructor
@Component
public class FileHandler {
	private final String Up_DIR = "D:\\_javaweb\\_java\\fileUpload";

	public List<fileVO> upladFiles(MultipartFile[] files) {
		LocalDate date = LocalDate.now(); // 현재 날짜 생성
		log.info(">>> date : " + date);
		String today = date.toString(); // 오늘 날짜 기준 2022-12-27 이렇게 보임
		// 파일 구분자로 변경하고 싶다면 -> 2022-01-01 -> 2022\01\01
		today = today.replace("-", File.separator);

		File folders = new File(Up_DIR, today); // up폴더 밑에 today 폴더를 생성하겠다
		// 폴더가 있으면 생성X, 없으면 생성
		if (!folders.exists()) {
			folders.mkdirs(); // mkdirs: 폴더 생성해라
		}
		// 파일 경로설정 완료
		List<fileVO> fList = new ArrayList<fileVO>();
		for (MultipartFile file : files) {
			fileVO fvo = new fileVO();
			fvo.setSave_dir(today); // 전체 경로를 담고싶다면 today eotlsdp folders를 담으면 됨
			fvo.setFile_size(file.getSize());

			String originalFileName = file.getOriginalFilename();
			log.info(">>> fileName" + originalFileName);

			String onlyFileName = originalFileName.substring(originalFileName.lastIndexOf("\\")) + 1;
			log.info(">>> only fileName : "+onlyFileName);
			fvo.setFile_name(onlyFileName);
		}
		return fList;
	}
}
